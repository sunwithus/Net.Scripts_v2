@* WhOllProcessWithDb2.razor *@

@page "/temp-page"
@rendermode InteractiveServer

@using MudBlazorWeb2.Components.Modules.WhOllProcessWithDb
@inject IConfiguration Configuration
@inject SettingsService SettingsService

<PageTitle>💬 Process Oracle 🚀</PageTitle>

<MudContainer>
    <MudText Typo="Typo.h5" Style="display:flex; justify-content:space-between;">Обработка аудиоданных Oracle => 💬 + 🚀 <MudText Style="height:30px;"><EditDefaultTaskToAi colorButton="@colorTag" OnApplyButtonClick="LoadSettings" /></MudText></MudText>
    <MudDivider />
    <br />
    @if (settingsDB != null)
    {
        <Processor colorTag="@colorTag" settingsDB="@settingsDB" oraItemsDB="@settingsDB.SettingsSputnik.OraItems" propertyName="SettingsSputnik" Scheme="@Scheme" />
    }
    
</MudContainer>


@code {

    MudBlazor.Color colorTag = Color.Tertiary;
    private Settings settingsDB = null;
    private string Scheme = "sputnik";


    protected override async Task OnInitializedAsync()
    {
        await LoadSettings();
        if (!Directory.Exists(Configuration["AudioPathForProcessing"])) Directory.CreateDirectory(Configuration["AudioPathForProcessing"]);
        await Task.Delay(0);
    }

    private async Task LoadSettings()
    {
        settingsDB = SettingsService.GetSettings();
        await Task.Delay(0);
    }

    private async Task OnSettingsChanged()
    {
        await LoadSettings();
        await Task.Delay(1);
        Console.WriteLine("Настройки подключения к БД для Процесса обработки изменились");
    }

}